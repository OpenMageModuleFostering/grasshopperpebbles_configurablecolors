/**
 * GrasshopperPebbles extension 
 *
 * NOTICE OF LICENSE 
 *
 * This source file is subject to the License
 * that is bundled with this package in the file GP-LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://grasshopperpebbles.com/license.txt
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to support@grasshopperpebbles.com so we can send you a copy immediately.
 * 
 * @category    Grasshopperpebbles
 * @package     Grasshopperpebbles_Configurableproducts_Utilities
 * @license     http://grasshopperpebbles.com/gp-license.txt, http://devoutgeek.com/gp-license.txt
 * @copyright   Copyright (c) 2014 Grasshopperpebbles, LLC. (http://grasshopperpebbles.com)
 * @author      Les Green <support@grasshopperpebbles.com>
 */
(function(e){e.fn.extend({gpConfigurableColors:function(t){opts=e.extend({},e.configurableColors.defaults,t);return this.each(function(){new e.configurableColors(this,opts)})}});e.configurableColors=function(t,n){function h(t){var r=e.parseJSON(t);u=r.hasGender==""?false:true;var i=p(r.items);i=d(0);var s=e("#"+n.swatch_container+" a")[0];y(e(s))}function p(t){var n=[];var r=[];e.each(t,function(i,s){if(n.indexOf(s.color_name)==-1){n.push(s.color_name);r[r.length]=e(t).filter(function(){return this.color_name==s.color_name})}});e.each(r,function(e,t){o[e]=[t[0].color_name,t]});return true}function d(t){var r=n.color_map;var i,s,u,a,f;e.each(o,function(t,o){i=o[0];a=false;u=e("<a />").addClass(n.swatch_class);var f=x(u,false);if(r.length>0){s=e(r).filter(function(){return this.color_name==o[0]});if(s.length>0){if("color_hex"in s[0]){e(u).css("background-color",s[0]["color_hex"])}else if("color_class"in s[0]){a=true;e(u).addClass(s[0]["color_class"])}else if("color_image"in s[0]){e(u).append(e("<img />").attr("src",n.swatch_image_url+s[0]["color_image"]))}}else{e(u).css("background-color",i)}}else{e(u).css("background-color",i)}var l=v(o[1]);e(u).attr("title",o[0]).appendTo(e("#"+n.swatch_container)).data("settings",{color_id:l.color_id,color:i,isClass:a,assoc_id:l.assoc_id,large_src:l.large_src,zoom_src:l.zoom_src,thumbs:l.thumbs}).click(function(){y(e(this))})})}function v(t){var n="";var r;e.each(t,function(e,t){r=t.thumbs;if(t.large_src&&r.length!=0){n=t}});return n}function m(t){var n=spConfig.settings[s];e(n).val(t);var r=e(n).prop("selectedIndex");spConfig.settings[s].selectedIndex=r;var i=spConfig.settings[s];++s;Event.observe(i,"change",function(){});g(i,"change");if(u&&!a){a=true;setTimeout(function(){m(t)},1)}}function g(e,t){if(document.createEvent){var n=document.createEvent("HTMLEvents");n.initEvent(t,true,true);return!e.dispatchEvent(n)}else{var n=document.createEventObject();return e.fireEvent("on"+t,n)}}function y(t){if(i){e(i).removeClass(n.swatch_class_selected);var r=x(e(i),false)}i=t;var o=e(t).data("settings").isClass;if(!o){e(i).addClass(n.swatch_class_selected);var r=x(e(i),true)}spConfig.reloadPrice();e(l).children("span").remove();e(l).append(e("<span></span>").html(" "+e(t).data("settings").color));if(n.use_zoom){e("p.product-image img").remove();e("p.product-image").append(e("<a></a>").attr({href:e(t).data("settings").zoom_src,"class":"cloud-zoom",id:"cloudZoom",rel:"zoomWidth: '"+n.zoom_width+"',zoomHeight: '"+n.zoom_height+"',position: '"+n.zoom_position+"',smoothMove: 3,showTitle: true,titleOpacity: 0,lensOpacity: 0,tintOpacity: 0,softFocus: false"}).append(e("<img />").attr("src",e(t).data("settings").large_src)))}else{e("p.product-image img").attr("src",e(t).data("settings").large_src)}s=0;m(e(t).data("settings").color_id);b(t)}function b(t){var r,i;var s=e(t).data("settings").thumbs;e(".more-views ul").remove();var o=e("<ul></ul>").appendTo(".more-views");if(n.use_zoom){e.each(s,function(t,n){e(o).append(e("<li></li>").append(e("<a></a>").attr({rel:"useZoom: 'cloudZoom', smallImage: '"+n.large_src+"'",href:n.zoom_src}).addClass("cloud-zoom-gallery").append(e("<img />").attr("src",n.thumb_src))))});e(".cloud-zoom, .cloud-zoom-gallery").CloudZoom()}else{e.each(s,function(t,n){e(o).append(e("<li></li>").append(e("<a></a>").attr("href","#").append(e("<img />").attr("src",n.thumb_src)).click(function(){e("p.product-image img").attr("src",n.large_src)})))})}}function w(t,n,r,i,s,o){e.ajax({type:t,url:n,data:r,dataType:i,beforeSend:s,success:o,error:E})}function E(e,t,n){console.log(t)}function S(e){var t=0;for(elem in configItems){if(t==e){return elem}t++}}function x(t,r){if(r){if(n.swatch_selected_width){e(t).css("width",n.swatch_selected_width+"px")}if(n.swatch_selected_height){e(t).css("height",n.swatch_selected_height+"px")}if(n.swatch_selected_border_size){e(t).css("border-width",n.swatch_selected_border_size+"px")}if(n.swatch_selected_border_color){e(t).css("border-color",n.swatch_selected_border_color)}}else{if(n.swatch_width){e(t).css("width",n.swatch_width+"px")}if(n.swatch_height){e(t).css("height",n.swatch_height+"px")}if(n.swatch_selected_border_size){e(t).css("border","none")}}return true}var r=e(t);var i="";var s=0;var o=[];var u=true;var a=false;var f=e("#attribute"+n.color_attrib_id).parent().parent();e("#"+n.swatch_container).appendTo(e(f));if(n.hide_color_dropdown){e("#attribute"+n.color_attrib_id).hide()}var l=e(f).siblings("dt")[0];if(n.assoc_products_url){var c={product_id:n.product_id,thumb_size:n.thumb_size,large_size:n.large_size,zoom_size:n.zoom_image_size};w("GET",n.assoc_products_url,c,"text","",h)}};e.configurableColors.defaults={product_id:"",sp_config:"",assoc_products_url:"",swatch_container:"",swatch_class:"",swatch_class_selected:"",hide_color_dropdown:true,color_attrib_id:"",swatch_image_url:"",swatch_width:"",swatch_height:"",swatch_selected_width:"",swatch_selected_height:"",swatch_selected_border_size:"",swatch_selected_border_color:"",thumb_size:"",large_size:"",zoom_image_size:"",zoom_width:"",zoom_height:"",zoom_position:"",use_zoom:true}})(jQuery)